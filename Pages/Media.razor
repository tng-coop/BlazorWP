@page "/media"
@inject IJSRuntime JS

<style>
  .center-green-box {
    position: absolute;
    width: 150px;
    height: 150px;
    background-color: green;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.25rem;
  }
</style>


    <h3 id="media-library-label" class="px-4 mb-2">Media Library</h3>

    <!-- green box now shows @status -->
    <div class="center-green-box">@status</div>

    <!-- overlay (no spinner any more) -->
    <div @ref="overlayEl" class="media-overlay"></div>
    <iframe
      @ref="iframeEl"
      src="/wp-admin/upload.php"
      class="media-iframe">
    </iframe>

@code {
  private ElementReference iframeEl;
  private ElementReference overlayEl;
  private DotNetObjectReference<Media>? dotnetRef;

  private string status = "Loadingâ€¦";

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (firstRender)
    {
      dotnetRef = DotNetObjectReference.Create(this);
      await JS.InvokeVoidAsync("wpMedia.initMediaPage", iframeEl, overlayEl, dotnetRef);
    }
  }

  [JSInvokable]
  public Task IframeHasLoaded()
  {
    status = "Done";
    StateHasChanged();
    return Task.CompletedTask;
  }

  public void Dispose()
    => dotnetRef?.Dispose();
}
